{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
   <div class="row">
      <div class="col-sm-12 mt-2 left">
         <div class="row">
            <div class="col-md-6">
               <div class="card mb-3 bg-light border-primary" id="column-left">
                  <div class="card-body">
                     <div class="image-container">
                        <img class="card-img-top" src="{{ event.featured_image.url }}">
                     </div>
                     <h2 class="card-title">{{ event }}</h2>
                     <p class="card-text">{{ event.content }}</p>
                  </div>
               </div>
            </div>
            <div class="col-md-6">
               <div class="card mb-3 bg-light border-primary" id="column-right">
                  <div class="card-body">
                     {% if user.is_authenticated %}
                     {% if bookings %}
                     <h5>You are booked into the following slots for this event:</h5>
                     {% for booking in bookings %}
                     <form action="{% url 'cancel_booking' event.slug booking.id %}" method="POST" >
                        {% csrf_token %}   
                        <button type="submit" class="btn btn-danger">{{ booking }} - Cancel</button>
                     </form>
                     {% endfor %}
                     {% endif %}
                     {% if timeslots %}
                     <h5>The following timeslots are available for this event:</h5>
                     {% for timeslot in timeslots %}
                     {% if timeslot.number_of_attendees >= event.max_attendees %}
                     <h5>{{ timeslot }} - Sorry, this timeslot is fully booked</h5>
                     {% else %}
                     <form action="{% url 'make_booking' event.slug timeslot.id %}" method="POST" >
                        {% csrf_token %}   
                        <button type="submit" class="btn btn-success">{{ timeslot }} - Book</button>
                     </form>
                     {% endif %}
                     {% endfor %}
                     {% endif %}
                     {% else %}
                     {% for timeslot in timeslots %}
                     <p>{{timeslot}}</p>
                     {% endfor %}
                     <p>Please <a href="{% url 'account_login' %}">log in</a> or <a href="{% url 'account_signup' %}">create an account</a> in order to book events</p>
                     {% endif %}
                     <div class="border-primary-rounded-pill mt-3">
                     {% for comment in comments %}
                     <div class="mt-3 ml-auto">
                        <strong>
                           {{comment.name}}:
                        </strong>
                        "{{comment.content}}"
                     </div>
                     {% endfor %}
                     </div>
                     {% if user.is_authenticated %}
                     <h5 class="mt-3">Leave a comment:</h5>
                     <form method="post">
                        {{ comment_form }}
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary">Submit</button> 
                     </form>
                     {% else %}
                     <p class="mt-3">Log in to leave a comment!</p>
                     {% endif %}
                     {% if user_commented %}
                     <div class="alert-info alert-dismissible message" role="alert">
                        Your comment has been submitted and is awaiting approval
                        
                     </div>
                     {% endif %}
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>
{% endblock content %}